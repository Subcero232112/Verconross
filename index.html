<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubCode X - Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: linear-gradient(135deg, #8B0000 0%, #000000 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: #e0e0e0;
        }

        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: 15px;
            gap: 15px;
        }

        @media (min-width: 768px) {
            .container {
                flex-direction: row;
                height: 100vh;
                padding: 20px;
                gap: 20px;
            }
        }

        .editor-panel {
            flex: 1;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            min-height: 50vh;
        }

        @media (min-width: 768px) {
            .editor-panel {
                min-height: auto;
                padding: 20px;
            }
        }

        .panel-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 0, 0, 0.3);
        }

        .panel-title {
            color: #ff5555;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            background: #2a2a2a;
            color: #ff6b6b;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: linear-gradient(45deg, #b30000, #660000);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #8B0000, #4d0000);
            color: white;
        }

        .btn-info {
            background: linear-gradient(45deg, #4d0000, #2a0000);
            color: white;
        }

        .file-info {
            background: rgba(139, 0, 0, 0.3);
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 10px;
            color: #ffaaaa;
            font-size: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .editor-container {
            flex: 1;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: #0a0a0a;
            display: flex;
        }

        .line-numbers {
            width: 40px;
            background: #1a1a1a;
            color: #ff5555;
            padding: 12px 5px;
            font-size: 13px;
            line-height: 1.5;
            border-right: 1px solid #ff000033;
            user-select: none;
            overflow: hidden;
        }

        .code-container {
            flex: 1;
            position: relative;
            overflow: auto;
        }

        .code-editor {
            width: 100%;
            height: 100%;
            min-height: 200px;
            padding: 12px;
            background: #0a0a0a;
            color: #e0e0e0;
            border: none;
            outline: none;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            white-space: pre;
            overflow-wrap: normal;
        }

        .output-panel {
            flex: 0 0 auto;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            max-height: 40vh;
        }

        @media (min-width: 768px) {
            .output-panel {
                flex: 0 0 400px;
                max-height: none;
            }
        }

        .output-container {
            flex: 1;
            background: #0d0d0d;
            border-radius: 8px;
            padding: 12px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            color: #e0e0e0;
        }

        .output-line {
            margin-bottom: 6px;
            padding: 3px 8px;
            border-radius: 4px;
            word-break: break-word;
        }

        .output-error {
            background: rgba(255, 0, 0, 0.15);
            border-left: 3px solid #ff5555;
        }

        .output-success {
            background: rgba(0, 128, 0, 0.15);
            border-left: 3px solid #55aa55;
        }

        .output-debug {
            background: rgba(255, 165, 0, 0.15);
            border-left: 3px solid #ffaa00;
            font-style: italic;
        }

        .syntax-help {
            background: rgba(139, 0, 0, 0.2);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            color: #ffaaaa;
            font-size: 12px;
        }

        .syntax-help h4 {
            color: #ff5555;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .syntax-help code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 3px;
            color: #ff9999;
            display: inline-block;
            margin: 3px 0;
        }

        /* Resaltado de sintaxis */
        .keyword {
            color: #ff5555;
            font-weight: bold;
        }

        .string {
            color: #ffaa55;
        }

        .comment {
            color: #99aa77;
            font-style: italic;
        }

        .variable {
            color: #ff77cc;
        }

        .function {
            color: #ffff55;
        }

        .number {
            color: #55ff55;
        }

        .operator {
            color: #ff9999;
        }

        .mobile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid #ff000055;
        }

        .logo {
            font-weight: bold;
            color: #ff5555;
            font-size: 18px;
        }

        .mobile-controls {
            display: flex;
            gap: 8px;
        }

        @media (min-width: 768px) {
            .mobile-header {
                display: none;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #8B0000;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #ff0000;
        }

        .mobile-indicator {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(139, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 5px;
            backdrop-filter: blur(5px);
        }

        @media (min-width: 768px) {
            .mobile-indicator {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="mobile-header">
        <div class="logo">SubCode X</div>
        <div class="mobile-controls">
            <button class="btn btn-primary" onclick="ejecutarCodigo()">
                <span>‚ñ∂Ô∏è</span>
            </button>
            <button class="btn btn-info" onclick="cargarEjemplo()">
                <span>üìñ</span>
            </button>
        </div>
    </div>
    
    <div class="container">
        <!-- Panel del Editor -->
        <div class="editor-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <span>üìù</span>
                    <span>SubCode X Editor</span>
                </div>
                <div class="controls">
                    <button class="btn btn-secondary" onclick="crearNuevoArchivo()">
                        <span>üìÑ</span> Nuevo
                    </button>
                    <button class="btn btn-info" onclick="cargarEjemplo()">
                        <span>üìñ</span> Ejemplo
                    </button>
                    <button class="btn btn-primary" onclick="ejecutarCodigo()">
                        <span>‚ñ∂Ô∏è</span> Ejecutar
                    </button>
                </div>
            </div>
            
            <div class="file-info">
                <div><strong>Archivo:</strong> <span id="fileName">programa.subx</span></div>
                <div><strong>L√≠neas:</strong> <span id="lineCount">1</span></div>
                <div><strong>Caracteres:</strong> <span id="charCount">0</span></div>
            </div>
            
            <div class="editor-container">
                <div class="line-numbers" id="lineNumbers">1</div>
                <div class="code-container">
                    <textarea class="code-editor" id="codeEditor" placeholder="# Escribe tu c√≥digo SubCode X aqu√≠...
decir &quot;Hola mundo&quot;
variable nombre = &quot;SubCode X&quot;
decir &quot;Bienvenido a &quot; + nombre"></textarea>
                </div>
            </div>
        </div>

        <!-- Panel de Salida -->
        <div class="output-panel">
            <div class="panel-header">
                <div class="panel-title">
                    <span>üñ•Ô∏è</span>
                    <span>Salida</span>
                </div>
                <div class="controls">
                    <button class="btn btn-secondary" onclick="limpiarSalida()">
                        <span>üßπ</span> Limpiar
                    </button>
                </div>
            </div>

            <div class="syntax-help">
                <h4>üéØ Sintaxis SubCode X</h4>
                <div><code>decir "texto"</code> - Mostrar texto</div>
                <div><code>variable nombre = "valor"</code> - Crear variable</div>
                <div><code>si condicion entonces accion</code> - Condicional</div>
                <div><code>repetir N veces accion</code> - Bucle</div>
                <div><code>funcion nombre() ... finfuncion</code> - Funci√≥n</div>
                <div><code>esperar N</code> - Pausar N segundos</div>
            </div>

            <div class="output-container" id="outputContainer">
                <div class="output-line output-success">‚úÖ SubCode X Editor listo</div>
                <div class="output-line">üí° Escribe tu c√≥digo y presiona "Ejecutar"</div>
            </div>
        </div>
    </div>
    
    <div class="mobile-indicator">
        <span>üì±</span> Modo M√≥vil
    </div>

    <script>
        const editor = document.getElementById('codeEditor');
        const lineNumbers = document.getElementById('lineNumbers');
        const outputContainer = document.getElementById('outputContainer');
        const fileNameSpan = document.getElementById('fileName');
        const lineCountSpan = document.getElementById('lineCount');
        const charCountSpan = document.getElementById('charCount');

        // Int√©rprete SubCode X en JavaScript
        class SubCodeXInterpreter {
            constructor() {
                this.variables = {};
                this.funciones = {};
                this.enFuncion = null;
                this.output = [];
            }

            interpretar(codigo) {
                this.output = [];
                this.variables = {};
                this.funciones = {};
                this.enFuncion = null;

                const lineas = codigo.split('\n');
                
                for (let i = 0; i < lineas.length; i++) {
                    const linea = lineas[i].trim();
                    if (linea && !linea.startsWith('#')) {
                        try {
                            this.interpretarLinea(linea);
                        } catch (error) {
                            this.output.push({
                                type: 'error',
                                message: `Error en l√≠nea ${i + 1}: ${error.message}`
                            });
                        }
                    }
                }

                return this.output;
            }

            interpretarLinea(linea) {
                // Funci√≥n en definici√≥n
                if (this.enFuncion) {
                    if (linea === 'finfuncion') {
                        this.enFuncion = null;
                    } else {
                        this.funciones[this.enFuncion].push(linea);
                    }
                    return;
                }

                // Comando: decir
                if (linea.startsWith('decir ')) {
                    const contenido = linea.substring(6).trim();
                    const resultado = this.evaluarExpresion(contenido);
                    this.output.push({
                        type: 'output',
                        message: resultado
                    });
                }

                // Comando: variable
                else if (linea.startsWith('variable ')) {
                    const partes = linea.substring(9).split('=');
                    if (partes.length === 2) {
                        const nombre = partes[0].trim();
                        const valor = this.evaluarExpresion(partes[1].trim());
                        this.variables[nombre] = valor;
                        this.output.push({
                            type: 'debug',
                            message: `Variable '${nombre}' = '${valor}'`
                        });
                    }
                }

                // Comando: si
                else if (linea.startsWith('si ')) {
                    const partes = linea.substring(3).split(' entonces ');
                    if (partes.length === 2) {
                        const condicion = partes[0].trim();
                        const accion = partes[1].trim();
                        
                        if (this.evaluarCondicion(condicion)) {
                            this.interpretarLinea(accion);
                        }
                    }
                }

                // Comando: repetir
                else if (linea.startsWith('repetir ')) {
                    const partes = linea.split(' veces ');
                    if (partes.length === 2) {
                        const veces = parseInt(this.evaluarExpresion(partes[0].replace('repetir', '').trim()));
                        const accion = partes[1].trim();
                        
                        for (let i = 0; i < veces; i++) {
                            this.interpretarLinea(accion);
                        }
                    }
                }

                // Comando: funcion
                else if (linea.startsWith('funcion ')) {
                    const nombre = linea.substring(8).replace('()', '').trim();
                    this.funciones[nombre] = [];
                    this.enFuncion = nombre;
                    this.output.push({
                        type: 'debug',
                        message: `Definiendo funci√≥n '${nombre}'`
                    });
                }

                // Llamada a funci√≥n
                else if (linea.replace('()', '') in this.funciones) {
                    const nombreFuncion = linea.replace('()', '');
                    for (const lineaFuncion of this.funciones[nombreFuncion]) {
                        this.interpretarLinea(lineaFuncion);
                    }
                }

                // Comando: esperar (simulado)
                else if (linea.startsWith('esperar ')) {
                    const tiempo = this.evaluarExpresion(linea.substring(8).trim());
                    this.output.push({
                        type: 'debug',
                        message: `Esperando ${tiempo} segundos...`
                    });
                }
            }

            evaluarExpresion(expr) {
                if (!expr) return '';

                // Cadena entre comillas
                if (expr.startsWith('"') && expr.endsWith('"')) {
                    return expr.slice(1, -1);
                }

                // Variable
                if (expr in this.variables) {
                    return this.variables[expr];
                }

                // N√∫mero
                if (!isNaN(expr)) {
                    return expr;
                }

                // Expresi√≥n con concatenaci√≥n
                let resultado = '';
                const tokens = this.tokenizar(expr);
                
                for (const token of tokens) {
                    if (token === '+') continue;
                    
                    if (token.startsWith('"') && token.endsWith('"')) {
                        resultado += token.slice(1, -1);
                    } else if (token in this.variables) {
                        resultado += this.variables[token];
                    } else if (!isNaN(token)) {
                        resultado += token;
                    } else {
                        resultado += token;
                    }
                }

                return resultado;
            }

            tokenizar(expr) {
                const tokens = [];
                let i = 0;
                let tokenActual = '';

                while (i < expr.length) {
                    const char = expr[i];

                    if (char === '"') {
                        if (tokenActual) {
                            tokens.push(tokenActual.trim());
                            tokenActual = '';
                        }

                        let cadena = '"';
                        i++;
                        while (i < expr.length && expr[i] !== '"') {
                            cadena += expr[i];
                            i++;
                        }
                        if (i < expr.length) {
                            cadena += '"';
                        }
                        tokens.push(cadena);
                    } else if (char === '+') {
                        if (tokenActual) {
                            tokens.push(tokenActual.trim());
                            tokenActual = '';
                        }
                        tokens.push('+');
                    } else if (char === ' ') {
                        if (tokenActual) {
                            tokens.push(tokenActual.trim());
                            tokenActual = '';
                        }
                    } else {
                        tokenActual += char;
                    }

                    i++;
                }

                if (tokenActual) {
                    tokens.push(tokenActual.trim());
                }

                return tokens.filter(t => t);
            }

            evaluarCondicion(cond) {
                if (cond.includes('==')) {
                    const [a, b] = cond.split('==');
                    return this.evaluarExpresion(a.trim()) === this.evaluarExpresion(b.trim());
                }
                if (cond.includes('!=')) {
                    const [a, b] = cond.split('!=');
                    return this.evaluarExpresion(a.trim()) !== this.evaluarExpresion(b.trim());
                }
                return false;
            }
        }

        const interprete = new SubCodeXInterpreter();

        // Actualizar n√∫meros de l√≠nea
        function actualizarLineas() {
            const lineas = editor.value.split('\n');
            const numeroLineas = lineas.length;
            
            lineNumbers.innerHTML = '';
            for (let i = 1; i <= numeroLineas; i++) {
                lineNumbers.innerHTML += i + '\n';
            }
            
            lineCountSpan.textContent = numeroLineas;
            charCountSpan.textContent = editor.value.length;
        }

        // Resaltado de sintaxis
        function aplicarResaltado() {
            const codigo = editor.value;
            // El resaltado se aplica visualmente con CSS
            actualizarLineas();
        }

        // Ejecutar c√≥digo
        function ejecutarCodigo() {
            const codigo = editor.value;
            if (!codigo.trim()) {
                mostrarOutput([{
                    type: 'error',
                    message: '‚ùå No hay c√≥digo para ejecutar'
                }]);
                return;
            }

            mostrarOutput([{
                type: 'debug',
                message: 'üöÄ Ejecutando c√≥digo...'
            }]);

            setTimeout(() => {
                const resultado = interprete.interpretar(codigo);
                mostrarOutput(resultado);
            }, 100);
        }

        // Mostrar salida
        function mostrarOutput(output) {
            outputContainer.innerHTML = '';
            
            if (output.length === 0) {
                outputContainer.innerHTML = '<div class="output-line output-success">‚úÖ C√≥digo ejecutado sin salida</div>';
                return;
            }

            output.forEach(item => {
                const div = document.createElement('div');
                div.className = 'output-line';
                
                switch (item.type) {
                    case 'error':
                        div.className += ' output-error';
                        div.textContent = item.message;
                        break;
                    case 'debug':
                        div.className += ' output-debug';
                        div.textContent = `üêõ ${item.message}`;
                        break;
                    case 'output':
                    default:
                        div.className += ' output-success';
                        div.textContent = item.message;
                        break;
                }
                
                outputContainer.appendChild(div);
            });
            
            outputContainer.scrollTop = outputContainer.scrollHeight;
        }

        // Limpiar salida
        function limpiarSalida() {
            outputContainer.innerHTML = '<div class="output-line output-success">‚úÖ Salida limpiada</div>';
        }

        // Crear nuevo archivo
        function crearNuevoArchivo() {
            editor.value = '';
            fileNameSpan.textContent = 'programa.subx';
            actualizarLineas();
            mostrarOutput([{
                type: 'success',
                message: 'üìÑ Nuevo archivo creado'
            }]);
        }

        // Cargar ejemplo
        function cargarEjemplo() {
            const ejemplo = `# SubCode X - Programa de Ejemplo
# Demostrando las funcionalidades del lenguaje

decir "üöÄ Bienvenido a SubCode X"
decir "=========================="

# Variables
variable nombre = "Programador"
variable lenguaje = "SubCode X"
variable version = "1.0"

# Mostrar informaci√≥n
decir "Hola " + nombre
decir "Est√°s usando " + lenguaje + " v" + version

# Condicionales
si nombre == "Programador" entonces decir "‚úÖ Usuario reconocido"
si version == "1.0" entonces decir "‚úÖ Versi√≥n correcta"

# Bucles
decir "Contando hasta 3:"
repetir 3 veces decir "N√∫mero procesado"

# Funciones
funcion saludar()
decir "¬°Hola desde una funci√≥n!"
decir "SubCode X es genial"
finfuncion

funcion despedida()
decir "Gracias por usar SubCode X"
decir "¬°Hasta la pr√≥xima!"
finfuncion

# Ejecutar funciones
saludar()
esperar 1
despedida()

decir "üéØ Programa completado"`;

            editor.value = ejemplo;
            fileNameSpan.textContent = 'ejemplo.subx';
            actualizarLineas();
            mostrarOutput([{
                type: 'success',
                message: 'üìñ Ejemplo cargado'
            }]);
        }

        // Event listeners
        editor.addEventListener('input', aplicarResaltado);
        editor.addEventListener('scroll', () => {
            lineNumbers.scrollTop = editor.scrollTop;
        });

        // Atajos de teclado
        editor.addEventListener('keydown', (e) => {
            // Ctrl+Enter para ejecutar
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                ejecutarCodigo();
            }
            
            // Tab para indentaci√≥n
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = editor.selectionStart;
                const end = editor.selectionEnd;
                editor.value = editor.value.substring(0, start) + '    ' + editor.value.substring(end);
                editor.selectionStart = editor.selectionEnd = start + 4;
                aplicarResaltado();
            }
        });

        // Inicializar
        actualizarLineas();
        cargarEjemplo();
    </script>
</body>
</html>
